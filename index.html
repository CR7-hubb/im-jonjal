<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>슈퍼갓 RPG v6 안정화 + 회피</title>
<style>
html,body{margin:0;overflow:hidden;background:#000;}
canvas{display:block;margin:auto;border:3px solid #fff;background:#1b5e20;}
#ui{position:absolute;top:10px;left:10px;color:white;font-family:"Press Start 2P",monospace;font-size:12px;text-shadow:1px 1px 2px black;}
#msgBox{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:80%;background:rgba(0,0,0,0.6);color:white;font-family:"Press Start 2P",monospace;font-size:11px;padding:15px;border:2px solid white;border-radius:10px;display:none;}
</style>
</head>
<body>
<canvas id="gameCanvas" width="960" height="640"></canvas>
<div id="ui">❤️ HP: <span id="hp">100</span> | 🔥 MP: <span id="mp">50</span> | 💰 Gold: <span id="gold">0</span> | Shift: 회피</div>
<div id="msgBox"></div>
<script>
// ===========================
// 설정
// ===========================
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
const hpUI=document.getElementById("hp");
const mpUI=document.getElementById("mp");
const goldUI=document.getElementById("gold");
const msgBox=document.getElementById("msgBox");

const TILE=32, MAP_W=30, MAP_H=20;
let keys={};

// ===========================
// 플레이어
// ===========================
const player={x:5,y:5,hp:100,mp:50,gold:0,speed:2,dodge:false,alive:true,anim:0,dir:0};
const playerImg=new Image();
playerImg.src="https://i.ibb.co/ZYW3VTp/brown-brim.png"; // 임시 안정 이미지

// ===========================
// 맵 생성
// ===========================
const map=[]; for(let y=0;y<MAP_H;y++){const row=[]; for(let x=0;x<MAP_W;x++){row.push(0);} map.push(row);}

// ===========================
// 몬스터
// ===========================
const monsters=[{x:15,y:10,hp:30,atk:5},{x:20,y:15,hp:40,atk:8}];
const boss={x:25,y:5,hp:100,atk:15,alive:true};

// ===========================
// 키 입력
// ===========================
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

// ===========================
// 전투
// ===========================
function checkCombat(){
    for(let m of monsters){
        if(m.hp<=0) continue;
        let dx=Math.abs(player.x-m.x), dy=Math.abs(player.y-m.y);
        if(dx<1 && dy<1){
            if(!player.dodge){player.hp-=m.atk; showMsg("몬스터 공격!");}
        }
    }
    if(boss.alive){
        let dx=Math.abs(player.x-boss.x), dy=Math.abs(player.y-boss.y);
        if(dx<1 && dy<1){
            if(!player.dodge){player.hp-=boss.atk; showMsg("보스 공격!");}
        }
    }
}

// ===========================
// UI 메시지
// ===========================
let msgTimer=null;
function showMsg(txt){
    msgBox.textContent=txt;
    msgBox.style.display="block";
    if(msgTimer) clearTimeout(msgTimer);
    msgTimer=setTimeout(()=>{msgBox.style.display="none";},1500);
}

// ===========================
// 업데이트
// ===========================
function update(){
    if(!player.alive) return;

    let speed=player.speed;
    player.dodge=keys["Shift"];

    if(keys["ArrowUp"] && player.y>0) player.y -= speed/4;
    if(keys["ArrowDown"] && player.y<MAP_H-1) player.y += speed/4;
    if(keys["ArrowLeft"] && player.x>0) player.x -= speed/4;
    if(keys["ArrowRight"] && player.x<MAP_W-1) player.x += speed/4;

    checkCombat();
    if(player.hp<=0){player.hp=0;player.alive=false; showMsg("💀 게임 오버");}
}

// ===========================
// 그리기
// ===========================
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // 맵
    for(let y=0;y<MAP_H;y++){
        for(let x=0;x<MAP_W;x++){
            ctx.fillStyle="#1b5e20";
            ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
        }
    }
    // 몬스터
    ctx.fillStyle="red";
    for(let m of monsters){if(m.hp>0) ctx.fillRect(m.x*TILE,m.y*TILE,TILE,TILE);}
    // 보스
    if(boss.alive) ctx.fillStyle="purple",ctx.fillRect(boss.x*TILE,boss.y*TILE,TILE,TILE);
    // 플레이어
    ctx.drawImage(playerImg,player.x*TILE,player.y*TILE,TILE,TILE);
}

// ===========================
// 루프
// ===========================
function loop(){update();draw();hpUI.textContent=Math.floor(player.hp);mpUI.textContent=Math.floor(player.mp);goldUI.textContent=Math.floor(player.gold);requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
